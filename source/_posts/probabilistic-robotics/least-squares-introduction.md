---
title: least_squares_introduction
date: 2020-10-30 22:59:37
tags:
    - 概率机器人
    - slam
    - robotics
categories:
    - rototics
mathjax: true  
---

最小二乘算法简介。

<!-- more -->

# 简介

移动机器人slam 解决方案，一般包括，卡尔曼滤波器，粒子滤波器以及图优化。基于图优化的slam是目前的主流方案。最小二乘方法是基于图优化的slam采用的主要工具。

总体来说，最小二乘是一个求解超定方程的方法。超定方程中方程的个数多于未知数的个数，此时通过最小化方程中的误差平方和，来求解未知数。最小二乘方法是求解大规模问题的标准方法，经常用来在给定观测的情况下估计模型的参数。

# 问题定义

系统由一系列的观测方程$\{f_i(\mathbf x) \}_{i=1:n}$ 所描述,表示机器人状态到测量值的映射关系。并做如下定义:

- $\mathbf x$ 表示系统的状态向量,我们需要估计的量，在移动机器人中，通常表示机器人位置和旋转角.
- $\mathbf z_i$ 表示跟系统状态$\mathbf x$ 有关的实际测量值(real measurements)。
- $\hat{\mathbf z}_i=f_i(\mathbf x)$表示基于系统当前状态得到的预测的测量值(predicted measurements).
  
其中，关于状态$\mathbf x$ 的测量$\mathbf z_{i:n}$是已知的。我们的目标就是估计可以最好的解释 我们测量值的 系统状态。换句话说就是，系统状态如何配置，最有可能获取到目前的测量数据。

系统状态，预测的测量值，实际的测量值之间的关系如下图所示。

![](explain.png)

系统状态是未知的，是需要估计的量，但是需要注意，系统状态是有初始值的。根据系统状态，可以利用观测方程得到预测的测量值。实际的测量值实时通过传感器数据获取。我们目标就是，对系统状态进行最优估计，得到可以最好的解释当前测量值的状态量。也就是说，系统状态量处于什么值，才能最大概率获取到当前的测量数据。

例如，在计算机视觉中，$\mathbf x$表示世界坐标系下特征点的3D坐标，是我们需要估计的量，同时我们知道它的初始值是多少，$\mathbf z_i$为其在图像坐标系下的像素坐标，是真实的测量值。相机的pose已知，我们可以根据针孔相机模型$f_i(\mathbf x)$得到特征点在相机坐标系下预测的测量值$\hat{\mathbf{z}}_i$. 然后对特征点的3D位置进行估计，调整特征点的3D坐标，使得实际的测量值和预测的测量值的误差减小。

# 误差方程

误差方程就是实际的与预测的测量值的差异
$$\mathbf e_i(\mathbf x) = \mathbf z_i - f_i(\mathbf x)$$
我们假设误差的平均值为零，并且呈正态分布. Gauss 误差，信息矩阵为$\mathbf \Omega_i$, 测量的平方误差仅取决于系统状态，并且是标量.
$$e_i(\mathbf x) = \mathbf e_i^{\top}(\mathbf x)\mathbf \Omega_i \mathbf e_i(\mathbf x)$$

我们的目标就是，在给定的所有测量值情况下，找到最优的系统状态$\mathbf x^*$，使得误差最小。

![](error_function.png)

# 求解

我们考虑通过迭代的方式对系统状态进行求解。首先做如下假设

- 有"良好"的系统状态初始值
- 误差方程平滑
  
通过迭代方式求解主要包含如下几个步骤
- 在当前解/初始值附近，对误差项进行线性化
- 计算误差平方函数的一阶导数
- 将上一步得到的结果=0，求解线性方程
- 得到新状态
- 迭代

